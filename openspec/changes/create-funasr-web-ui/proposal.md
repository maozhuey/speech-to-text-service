# FunASR Web可视化界面提案

## Why
当前FunASR用户在本地运行语音识别服务后，缺乏一个直观、实时的可视化界面来查看转录结果。用户需要通过命令行或其他工具查看输出，体验不够友好，无法实现"所说即所见"的实时反馈效果。此外，现有的解决方案往往需要复杂的配置或安装多个组件，不符合零配置、开箱即用的需求。

## 变更概述
创建一个单文件Web应用，为FunASR本地实时语音转录服务提供零配置、开箱即用的可视化界面，实现"所说即所见"的实时反馈。

## 问题陈述
开发者或用户在本地运行FunASR服务后，缺乏一个直观、易用的界面来实时查看语音转录结果。当前需要通过命令行或其他工具查看输出，体验不够友好。

## 解决方案
开发一个基于HTML + Tailwind CSS + Vanilla JavaScript的单文件Web应用，通过WebSocket连接到本地FunASR服务（ws://127.0.0.1:10095），实时展示语音转录的流式字幕。

## 核心能力

### 1. WebSocket连接管理
- **自动连接**：页面加载后自动尝试连接到 `ws://127.0.0.1:10095`
- **连接状态指示器**：
  - 连接中：显示"正在连接..."，黄色指示器
  - 连接成功：显示"已连接"，绿色指示器
  - 连接失败/断开：显示"已断开"，红色指示器
- **自动重连机制**：连接断开后每5秒自动尝试重连
- **手动重连**：提供"重新连接"按钮

### 2. 实时文本流式显示
- **消息格式解析**：处理JSON格式的WebSocket消息
  ```json
  {"mode": "2pass-online", "text": "识别到的文字", "is_final": false, "timestamp": "..."}
  ```
- **文本区分显示**：
  - 中间稿（is_final: false）：以灰色显示在当前句子末尾，可被后续结果覆盖
  - 最终稿（is_final: true）：替换当前行所有中间稿，成为固定句子，开启新行
- **自动滚动**：新内容添加时平滑滚动到底部
- **性能优化**：大文本量情况下保持流畅

### 3. 文本操作功能
- **复制全部**：将所有最终文本复制到剪贴板
- **清空屏幕**：清除所有显示的文本内容

### 4. UI/UX设计
- **整体风格**：现代、简约、专注的"禅模式"界面
- **暗色主题**：
  - 背景色：深灰色 #1E1E1E
  - 最终文本：白色/浅灰色 #D4D4D4
  - 中间文本：灰色 #888888
  - 状态指示器：绿#34D399、黄#FBBF24、红#F87171
- **布局设计**：
  - 主体内容水平居中，保持边距
  - 无衬线字体，18px大小，1.8行高
  - 按钮简洁，有悬停效果

## 技术决策

### 技术栈选择
- **前端**：HTML + Tailwind CSS (CDN) + Vanilla JavaScript
- **后端**：无（纯前端应用）
- **存储**：无状态，关闭页面后内容消失
- **通信**：WebSocket直连本地服务

### 架构设计
- **单文件架构**：所有代码封装在一个index.html文件中
- **模块化设计**：JavaScript使用函数封装不同功能
- **零依赖**：除了Tailwind CSS CDN，无其他外部依赖
- **高可移植性**：用户下载一个文件即可使用

### 文件结构
```
project/
└── index.html  (包含所有 HTML, CSS, 和 JS)
```

## 详细实现规范

### WebSocket消息处理逻辑
1. 为每句话创建独立的容器元素
2. 中间稿作为子元素追加，可被替换
3. 最终稿替换整个容器的innerHTML
4. 维护当前活动句子的引用

### DOM更新优化
1. 使用DocumentFragment减少重排
2. 批量处理连续的文本更新
3. 使用CSS transform实现滚动
4. 限制保留的DOM节点数量

### 错误处理机制
1. WebSocket连接超时处理
2. 消息格式异常捕获
3. 用户操作反馈提示

## 影响范围
- 新增：index.html单文件应用
- 新增：WebSocket通信模块
- 新增：实时文本渲染引擎
- 新增：UI组件系统
- 新增：文本操作工具

## 验收标准

### 功能验收
1. 页面加载后自动连接WebSocket服务
2. 正确解析JSON消息格式
3. 准确区分和显示中间稿/最终稿
4. 实现平滑的自动滚动效果
5. 复制和清空功能正常工作
6. 连接状态实时更新显示

### 性能验收
1. 长时间运行（1小时+）无内存泄漏
2. 大文本量（10000+行）滚动流畅
3. 频繁消息（每秒10+）更新不卡顿
4. 页面响应时间保持在100ms内

### 兼容性验收
1. 支持Chrome 80+、Firefox 75+、Safari 13+
2. 支持桌面和移动端浏览器
3. WebSocket API可用性检测

## 约束条件
- 必须是单文件交付
- 使用Tailwind CSS CDN版本
- JavaScript代码写在<script>标签内
- 不支持文件上传，仅连接本地服务
- 仅支持中文显示（可扩展）

## 风险评估与缓解

### 技术风险
- **风险**：WebSocket兼容性问题
- **缓解**：添加特性检测和降级提示

### 性能风险
- **风险**：大量DOM操作导致卡顿
- **缓解**：实现虚拟滚动或分页加载

### 用户体验风险
- **风险**：中间稿和最终稿混淆
- **缓解**：使用明显的视觉区分和动画效果

## 后续扩展计划
1. 添加字体大小调节功能
2. 支持主题切换（亮色/暗色）
3. 添加导出功能（TXT、SRT格式）
4. 支持多语言界面
5. 添加快捷键操作